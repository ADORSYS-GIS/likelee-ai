services:
  gateway:
    image: nginx:alpine
    container_name: likelee-gateway
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ./certs:/etc/nginx/certs:ro
    depends_on:
      - ui
      - server
    networks:
      - likelee

  server:
    build:
      context: ../../
      dockerfile: likelee-server/Dockerfile
    container_name: likelee-server
    restart: unless-stopped
    env_file:
      - ./.env
    environment:
      RUST_LOG: info
    expose:
      - "8787"
    networks:
      - likelee

  ui:
    build:
      context: ../../
      dockerfile: likelee-ui/Dockerfile
      args:
        VITE_KEYCLOAK_URL: ${VITE_KEYCLOAK_URL}
        VITE_KEYCLOAK_REALM: ${VITE_KEYCLOAK_REALM}
        VITE_KEYCLOAK_CLIENT_ID: ${VITE_KEYCLOAK_CLIENT_ID}
        VITE_SUPABASE_URL: ${VITE_SUPABASE_URL}
        VITE_SUPABASE_ANON_KEY: ${VITE_SUPABASE_ANON_KEY}
        VITE_API_BASE_URL: ${VITE_API_BASE_URL:-/api}
        VITE_AWS_REGION: ${VITE_AWS_REGION}
        VITE_COGNITO_IDENTITY_POOL_ID: ${VITE_COGNITO_IDENTITY_POOL_ID}
    container_name: likelee-ui
    restart: unless-stopped
    expose:
      - "8080"
    networks:
      - likelee

networks:
  likelee:
    driver: bridge
